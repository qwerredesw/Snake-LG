<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Snake — Liquid Glass Edition</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background:
        radial-gradient(circle at 10% 20%, #0ff 0, transparent 50%),
        radial-gradient(circle at 90% 80%, #f0f 0, transparent 50%),
        radial-gradient(circle at 50% 50%, #0ff2 0, #020513 55%, #000 100%);
      color: #e5f3ff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      overflow: hidden;
      padding: 16px;
    }

    .wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 18px;
    }

    .glass-panel {
      position: relative;
      padding: 18px 20px 20px;
      border-radius: 26px;
      background: linear-gradient(135deg, rgba(255,255,255,0.16), rgba(255,255,255,0.03));
      border: 1px solid rgba(255,255,255,0.3);
      box-shadow:
        0 24px 60px rgba(0,0,0,0.65),
        0 0 0 1px rgba(255,255,255,0.04);
      backdrop-filter: blur(18px) saturate(180%);
      -webkit-backdrop-filter: blur(18px) saturate(180%);
      width: 100%;
      max-width: 420px;
    }

    .glass-panel::before {
      content: "";
      position: absolute;
      inset: 1px;
      border-radius: inherit;
      background: radial-gradient(circle at 0 0, rgba(255,255,255,0.2), transparent 60%);
      opacity: 0.7;
      pointer-events: none;
      mix-blend-mode: screen;
    }

    .glass-panel-inner {
      position: relative;
      z-index: 1;
    }

    h1 {
      font-size: 18px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: #cfe9ff;
      text-shadow: 0 0 12px rgba(0,255,255,0.55);
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      white-space: nowrap;
    }

    h1::before {
      content: "";
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: radial-gradient(circle, #0ff, #008aff);
      box-shadow: 0 0 15px rgba(0,255,255,0.9);
    }

    .subtitle {
      font-size: 11px;
      opacity: 0.7;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      margin-bottom: 10px;
    }

    .stats-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      font-size: 13px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }

    .stat-chip {
      padding: 6px 10px;
      border-radius: 999px;
      background: linear-gradient(120deg, rgba(0,255,255,0.12), rgba(255,255,255,0.02));
      border: 1px solid rgba(0,255,255,0.35);
      box-shadow: 0 0 20px rgba(0,255,255,0.16);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .stat-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      opacity: 0.75;
    }

    .stat-value {
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 13px;
    }

    .controls-hint {
      font-size: 11px;
      opacity: 0.7;
      text-align: center;
      margin-top: 4px;
    }

    .controls-hint span {
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background: rgba(0,0,0,0.35);
      padding: 2px 6px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.2);
      margin: 0 2px;
      font-size: 10px;
    }

    .game-shell {
      position: relative;
      padding: 14px;
      border-radius: 30px;
      background: linear-gradient(135deg, rgba(255,255,255,0.22), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.32);
      box-shadow:
        0 25px 70px rgba(0,0,0,0.85),
        0 0 40px rgba(0,255,255,0.32);
      backdrop-filter: blur(26px) saturate(200%);
      -webkit-backdrop-filter: blur(26px) saturate(200%);
      width: 100%;
      max-width: 420px;
    }

    .game-shell::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: conic-gradient(from 140deg,
        rgba(0,255,255,0.3),
        rgba(255,255,255,0.0),
        rgba(255,0,255,0.3),
        rgba(0,255,255,0.0),
        rgba(0,255,255,0.3)
      );
      mix-blend-mode: screen;
      opacity: 0.7;
      pointer-events: none;
      filter: blur(24px);
    }

    .game-shell-inner {
      position: relative;
      z-index: 1;
    }

    .game-frame {
      position: relative;
      border-radius: 24px;
      padding: 10px;
      background: radial-gradient(circle at 0 0, rgba(255,255,255,0.2), transparent 60%),
                  radial-gradient(circle at 100% 100%, rgba(0,255,255,0.18), transparent 60%),
                  rgba(2,5,20,0.96);
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.1),
        0 0 25px rgba(0,255,255,0.35);
      overflow: hidden;
    }

    .game-frame::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
      background:
        linear-gradient(120deg, rgba(255,255,255,0.1), transparent 40%, rgba(0,255,255,0.15), transparent 70%);
      mix-blend-mode: screen;
      opacity: 0.6;
    }

    .canvas-wrapper {
      position: relative;
    }

    canvas {
      display: block;
      border-radius: 20px;
      background:
        radial-gradient(circle at 0 0, rgba(255,255,255,0.18), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(0,255,255,0.16), transparent 60%),
        linear-gradient(145deg, #050616, #050814);
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.12),
        0 18px 40px rgba(0,0,0,0.8),
        0 0 40px rgba(0,255,255,0.28);
      position: relative;
    }

    .grid-overlay {
      position: absolute;
      inset: 0;
      border-radius: 20px;
      pointer-events: none;
      background-image:
        linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
      background-size: 16px 16px;
      mix-blend-mode: soft-light;
      opacity: 0.7;
    }

    .game-glass-overlay {
      position: absolute;
      inset: 0;
      border-radius: 20px;
      pointer-events: none;
      background:
        radial-gradient(circle at 0 0, rgba(255,255,255,0.18), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(0,255,255,0.18), transparent 60%);
      mix-blend-mode: screen;
      opacity: 0.55;
    }

    .game-overlay {
      position: absolute;
      inset: 10px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 50% 30%, rgba(10,15,40,0.9), rgba(2,3,8,0.96));
      color: #e5f3ff;
      flex-direction: column;
      gap: 10px;
      text-align: center;
      z-index: 5;
    }

    .game-overlay.hidden {
      display: none;
    }

    .overlay-title {
      font-size: 22px;
      letter-spacing: 0.24em;
      text-transform: uppercase;
      text-shadow: 0 0 20px rgba(0,255,255,0.7);
    }

    .overlay-score {
      font-size: 13px;
      opacity: 0.85;
    }

    .overlay-hint {
      font-size: 12px;
      opacity: 0.7;
      margin-top: 6px;
    }

    .btn {
      margin-top: 4px;
      padding: 8px 20px;
      border-radius: 999px;
      border: 1px solid rgba(0,255,255,0.65);
      background: radial-gradient(circle at 0 0, rgba(255,255,255,0.22), transparent 60%);
      color: #e5f3ff;
      font-size: 12px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      cursor: pointer;
      box-shadow:
        0 0 20px rgba(0,255,255,0.65),
        0 8px 20px rgba(0,0,0,0.7);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.15s ease;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow:
        0 0 26px rgba(0,255,255,0.9),
        0 12px 24px rgba(0,0,0,0.8);
      background: radial-gradient(circle at 0 0, rgba(255,255,255,0.28), transparent 65%);
    }

    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow:
        0 0 14px rgba(0,255,255,0.7),
        0 7px 16px rgba(0,0,0,0.85);
    }

    /* On-screen controls */
    .on-screen-controls {
      margin-top: 14px;
      display: none; /* по умолчанию скрыты, будут только на телефоне */
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .dpad {
      display: grid;
      grid-template-columns: 50px 50px 50px;
      grid-template-rows: 50px 50px 50px;
      gap: 8px;
    }

    .dpad-btn {
      border-radius: 18px;
      border: 1px solid rgba(0,255,255,0.8);
      background: linear-gradient(145deg, rgba(255,255,255,0.18), rgba(0,10,20,0.9));
      box-shadow:
        0 10px 25px rgba(0,0,0,0.85),
        0 0 18px rgba(0,255,255,0.7);
      backdrop-filter: blur(14px) saturate(200%);
      -webkit-backdrop-filter: blur(14px) saturate(200%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e5f3ff;
      font-size: 18px;
      cursor: pointer;
      user-select: none;
      touch-action: manipulation;
      position: relative;
      overflow: hidden;
    }

    .dpad-btn::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(255,255,255,0.26), transparent 70%);
      mix-blend-mode: screen;
      opacity: 0.8;
      pointer-events: none;
    }

    .dpad-btn:active {
      transform: translateY(1px) scale(0.97);
      box-shadow:
        0 6px 16px rgba(0,0,0,0.9),
        0 0 12px rgba(0,255,255,0.6);
    }

    .dpad-empty {
      pointer-events: none;
      opacity: 0;
    }

    /* Мобильный режим */
    body.mobile {
      padding: 12px;
      overflow-y: auto;
    }

    body.mobile .wrapper {
      width: 100%;
      max-width: 420px;
    }

    body.mobile .game-shell {
      max-width: 100%;
    }

    body.mobile .on-screen-controls {
      display: flex;
    }

    body.mobile .controls-hint {
      font-size: 10px;
    }

    @media (max-width: 600px) {
      body {
        padding: 10px;
      }

      .game-shell {
        box-shadow:
          0 14px 40px rgba(0,0,0,0.85),
          0 0 30px rgba(0,255,255,0.28);
      }

      .dpad {
        grid-template-columns: 56px 56px 56px;
        grid-template-rows: 56px 56px 56px;
      }
    }
  </style>
</head>
<body>
<div class="wrapper">
  <div class="glass-panel">
    <div class="glass-panel-inner">
      <h1>SNAKE // AITUBE</h1>
      <div class="subtitle">classic nokia logic • liquid glass ui</div>
      <div class="stats-row">
        <div class="stat-chip">
          <span class="stat-label">Score</span>
          <span class="stat-value" id="score">0</span>
        </div>
        <div class="stat-chip">
          <span class="stat-label">Best</span>
          <span class="stat-value" id="best">0</span>
        </div>
      </div>
      <div class="controls-hint">
        ПК: <span>↑</span><span>↓</span><span>←</span><span>→</span> • Restart: <span>Space / R</span><br>
        Телефон: стеклянные стрелки под игрой
      </div>
    </div>
  </div>

  <div class="game-shell">
    <div class="game-shell-inner">
      <div class="game-frame">
        <div class="canvas-wrapper">
          <canvas id="game" width="400" height="400"></canvas>
          <div class="grid-overlay"></div>
          <div class="game-glass-overlay"></div>

          <div id="overlay" class="game-overlay">
            <div class="overlay-title">Snake</div>
            <div class="overlay-score" id="overlayText">Нажми Start</div>
            <div class="overlay-hint">Классическая змейка как в старых Nokia<br>без изменений геймплея</div>
            <button class="btn" id="startBtn">Start</button>
            <div class="overlay-hint">или стрелки / стеклянный D-Pad внизу</div>
          </div>
        </div>

        <div class="on-screen-controls" id="touchControls">
          <div class="dpad">
            <div class="dpad-empty"></div>
            <div class="dpad-btn" data-dir="up">▲</div>
            <div class="dpad-empty"></div>

            <div class="dpad-btn" data-dir="left">◀</div>
            <div class="dpad-empty"></div>
            <div class="dpad-btn" data-dir="right">▶</div>

            <div class="dpad-empty"></div>
            <div class="dpad-btn" data-dir="down">▼</div>
            <div class="dpad-empty"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // === КЛАССИЧЕСКАЯ ЛОГИКА "ЗМЕЙКИ" КАК В СТАРЫХ NOKIA ===
  // - движение по клеткам
  // - нет прохода через стены (ударился — умер)
  // - нельзя врезаться в себя
  // - еда увеличивает длину на 1
  // - без телепортов, ускорений и прочих модификаций

  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  const overlay = document.getElementById('overlay');
  const overlayText = document.getElementById('overlayText');
  const startBtn = document.getElementById('startBtn');

  const scoreEl = document.getElementById('score');
  const bestEl = document.getElementById('best');

  const touchControls = document.getElementById('touchControls');

  const GRID_COUNT = 20; // классическая сетка 20x20
  let CELL_SIZE = 20;    // будет пересчитываться под размер канваса
  const TICK_MS = 120;

  let snake;
  let direction;
  let nextDirection;
  let food;
  let score;
  let bestScore = Number(localStorage.getItem('snake_best_liquid_v2')) || 0;
  let timerId = null;
  let gameRunning = false;
  let waitingFirstMove = true;

  bestEl.textContent = bestScore;

  // Детект телефона (упрощённо: тач + вертикальный экран)
  const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

  function updateLayout() {
    const isPortrait = window.innerHeight >= window.innerWidth;
    const mobileMode = isTouchDevice && isPortrait;

    document.body.classList.toggle('mobile', mobileMode);

    let size;
    if (mobileMode) {
      size = Math.min(window.innerWidth - 40, 380);
      if (size < 260) size = 260; // минимум чтобы не превратилось в пиксели
    } else {
      size = 400;
    }

    canvas.width = size;
    canvas.height = size;

    CELL_SIZE = Math.floor(size / GRID_COUNT);

    // подправим сетку (grid-overlay и game-glass-overlay автоматически растягиваются)
    if (!gameRunning) {
      draw(); // перерисовать стартовый экран
    }
  }

  function initGame() {
    const startX = Math.floor(GRID_COUNT / 2);
    const startY = Math.floor(GRID_COUNT / 2);
    snake = [
      { x: startX - 2, y: startY },
      { x: startX - 1, y: startY },
      { x: startX,     y: startY }
    ];
    direction = { x: 1, y: 0 };
    nextDirection = { x: 1, y: 0 };
    score = 0;
    scoreEl.textContent = score;
    placeFood();
    waitingFirstMove = true;
    gameRunning = false;
    stopLoop();
    draw();
  }

  function startGame() {
    if (gameRunning) return;
    gameRunning = true;
    overlay.classList.add('hidden');
    startLoop();
  }

  function gameOver() {
    gameRunning = false;
    stopLoop();
    overlay.classList.remove('hidden');
    overlayText.textContent = `Игра окончена • Счёт: ${score}`;
    startBtn.textContent = 'Restart';
    if (score > bestScore) {
      bestScore = score;
      localStorage.setItem('snake_best_liquid_v2', bestScore);
      bestEl.textContent = bestScore;
    }
  }

  function startLoop() {
    if (timerId !== null) return;
    timerId = setInterval(tick, TICK_MS);
  }

  function stopLoop() {
    if (timerId !== null) {
      clearInterval(timerId);
      timerId = null;
    }
  }

  function placeFood() {
    let ok = false;
    while (!ok) {
      const x = Math.floor(Math.random() * GRID_COUNT);
      const y = Math.floor(Math.random() * GRID_COUNT);
      ok = !snake.some(segment => segment.x === x && segment.y === y);
      if (ok) {
        food = { x, y };
      }
    }
  }

  function tick() {
    // направление фиксируется на этот шаг
    direction = nextDirection;

    const head = snake[snake.length - 1];
    const newHead = {
      x: head.x + direction.x,
      y: head.y + direction.y
    };

    // столкновение со стеной
    if (
      newHead.x < 0 || newHead.x >= GRID_COUNT ||
      newHead.y < 0 || newHead.y >= GRID_COUNT
    ) {
      gameOver();
      return;
    }

    // столкновение с собой
    if (snake.some(s => s.x === newHead.x && s.y === newHead.y)) {
      gameOver();
      return;
    }

    snake.push(newHead);

    // еда
    if (newHead.x === food.x && newHead.y === food.y) {
      score++;
      scoreEl.textContent = score;
      placeFood();
    } else {
      snake.shift();
    }

    draw();
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // фон поля
    const grad = ctx.createRadialGradient(
      canvas.width / 2, canvas.height / 2, 10,
      canvas.width / 2, canvas.height / 2, canvas.width * 0.9
    );
    grad.addColorStop(0, '#151b35');
    grad.addColorStop(1, '#04040a');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    if (food) drawFood();
    if (snake) drawSnake();
  }

  function drawSnake() {
    for (let i = 0; i < snake.length; i++) {
      const segment = snake[i];
      const px = segment.x * CELL_SIZE;
      const py = segment.y * CELL_SIZE;

      // внешний жидко-стеклянный прямоугольник
      const segmentGrad = ctx.createLinearGradient(px, py, px + CELL_SIZE, py + CELL_SIZE);
      segmentGrad.addColorStop(0, 'rgba(255,255,255,0.22)');
      segmentGrad.addColorStop(1, 'rgba(0,255,255,0.12)');
      ctx.fillStyle = segmentGrad;
      ctx.fillRect(px + 2, py + 2, CELL_SIZE - 4, CELL_SIZE - 4);

      // внутренний слой
      const innerGrad = ctx.createLinearGradient(px, py, px, py + CELL_SIZE);
      innerGrad.addColorStop(0, 'rgba(4,10,30,0.9)');
      innerGrad.addColorStop(1, 'rgba(3,5,12,0.9)');
      ctx.fillStyle = innerGrad;
      ctx.fillRect(px + 4, py + 4, CELL_SIZE - 8, CELL_SIZE - 8);

      // неоновый контур
      ctx.strokeStyle = 'rgba(0,255,255,0.85)';
      ctx.lineWidth = 2;
      ctx.shadowColor = 'rgba(0,255,255,0.9)';
      ctx.shadowBlur = 10;
      ctx.strokeRect(px + 3, py + 3, CELL_SIZE - 6, CELL_SIZE - 6);
      ctx.shadowBlur = 0;

      // голова
      if (i === snake.length - 1) {
        ctx.fillStyle = '#0ff';
        const cx = px + CELL_SIZE / 2;
        const cy = py + CELL_SIZE / 2;
        ctx.beginPath();
        ctx.arc(cx, cy - CELL_SIZE * 0.15, CELL_SIZE * 0.15, 0, Math.PI * 2);
        ctx.fill();
      }
    }
  }

  function drawFood() {
    const px = food.x * CELL_SIZE;
    const py = food.y * CELL_SIZE;

    const haloGrad = ctx.createRadialGradient(
      px + CELL_SIZE / 2, py + CELL_SIZE / 2, 2,
      px + CELL_SIZE / 2, py + CELL_SIZE / 2, CELL_SIZE
    );
    haloGrad.addColorStop(0, 'rgba(0,255,255,0.7)');
    haloGrad.addColorStop(1, 'rgba(0,255,255,0)');
    ctx.fillStyle = haloGrad;
    ctx.beginPath();
    ctx.arc(px + CELL_SIZE / 2, py + CELL_SIZE / 2, CELL_SIZE / 2, 0, Math.PI * 2);
    ctx.fill();

    const coreGrad = ctx.createRadialGradient(
      px + CELL_SIZE / 2 - 3, py + CELL_SIZE / 2 - 3, 1,
      px + CELL_SIZE / 2, py + CELL_SIZE / 2, CELL_SIZE / 2
    );
    coreGrad.addColorStop(0, '#ffffff');
    coreGrad.addColorStop(0.35, '#0ff');
    coreGrad.addColorStop(1, '#0088ff');
    ctx.fillStyle = coreGrad;
    ctx.beginPath();
    ctx.arc(px + CELL_SIZE / 2, py + CELL_SIZE / 2, CELL_SIZE / 3, 0, Math.PI * 2);
    ctx.fill();
  }

  // === Управление с клавы ===
  window.addEventListener('keydown', (e) => {
    const key = e.key;

    if (!gameRunning && ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(key)) {
      if (!waitingFirstMove) {
        initGame();
      }
      waitingFirstMove = false;
      overlay.classList.add('hidden');
      startGame();
    }

    if (!gameRunning && (key === ' ' || key.toLowerCase() === 'r')) {
      initGame();
      overlay.classList.add('hidden');
      startGame();
      return;
    }

    handleDirectionInput(keyToDir(key));
  });

  function keyToDir(key) {
    if (key === 'ArrowUp') return 'up';
    if (key === 'ArrowDown') return 'down';
    if (key === 'ArrowLeft') return 'left';
    if (key === 'ArrowRight') return 'right';
    return null;
  }

  function handleDirectionInput(dir) {
    if (!dir) return;

    if (dir === 'up' && direction.y !== 1) {
      nextDirection = { x: 0, y: -1 };
    } else if (dir === 'down' && direction.y !== -1) {
      nextDirection = { x: 0, y: 1 };
    } else if (dir === 'left' && direction.x !== 1) {
      nextDirection = { x: -1, y: 0 };
    } else if (dir === 'right' && direction.x !== -1) {
      nextDirection = { x: 1, y: 0 };
    }
  }

  // === Тач-управление (Liquid Glass D-Pad) ===
  touchControls.addEventListener('touchstart', (e) => {
    const target = e.target.closest('.dpad-btn');
    if (!target) return;

    e.preventDefault();
    const dir = target.getAttribute('data-dir');

    if (!gameRunning) {
      if (!waitingFirstMove) {
        initGame();
      }
      waitingFirstMove = false;
      overlay.classList.add('hidden');
      startGame();
    }

    handleDirectionInput(dir);
  }, { passive: false });

  touchControls.addEventListener('click', (e) => {
    const target = e.target.closest('.dpad-btn');
    if (!target) return;

    const dir = target.getAttribute('data-dir');

    if (!gameRunning) {
      if (!waitingFirstMove) {
        initGame();
      }
      waitingFirstMove = false;
      overlay.classList.add('hidden');
      startGame();
    }

    handleDirectionInput(dir);
  });

  startBtn.addEventListener('click', () => {
    if (!gameRunning) {
      initGame();
      overlay.classList.add('hidden');
      startGame();
    }
  });

  // Первичная настройка и реакция на поворот экрана
  window.addEventListener('resize', () => {
    updateLayout();
  });

  updateLayout();
  initGame();
</script>
</body>
</html>
